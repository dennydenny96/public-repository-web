doctype html
html(lang='en')
  head
    meta(charset='utf-8')
    meta(http-equiv='X-UA-Compatible', content='IE=edge')
    meta(name='robots', content='noindex, nofollow')
    meta(name='viewport', content='width=device-width, initial-scale=1.0, user-scalable=0, minimal-ui')
    title #{lang.label.page_title}
    link(rel="shortcut icon", href="/dist/public/img/favicon.ico", type="image/x-icon")
    //- link(rel='stylesheet', type='text/css', href='/bower_components/bootstrap/dist/css/bootstrap.min.css')
    link(rel='stylesheet', type='text/css', href='/dist/public/css/bootstrap.min.css')
    link(href='./dist/public/_css/icons.css', rel='stylesheet', type='text/css')
    link(href='./dist/public/_css/style.css', rel='stylesheet', type='text/css')
    link(href='./dist/public/css/login.css', rel='stylesheet', type='text/css')
    script(src='./bower_components/jquery/dist/jquery.min.js')
    script(src='./dist/public/js/bootstrap.min.js')
    link(rel='stylesheet', href='/dist/public/css/daterangepicker.css?v=' + locals.vcss)
    
  body.fixed-left#testing
    .accountbg
    .wrapper-page#RegisterForm(style='margin:12% auto;')
      .card
        .card-body
          #ErrDivRegisterForm.alert.alert-block.alert-error(style="display:none; background-color:#ffedf0; color: red;")
            a.close(onClick="$('#ErrDivRegisterForm').hide()") X
            span#ErrRegisterMsg 
          .text-center.m-b-15
          .p-3#flagRegisterForm
            .boxRed#errorBoxRegister(style='display:none')
              label#errorRegister
            h3 Registration
            form#frmRegiter.form-horizontal.m-t-20(name='frmRegiter')
              input#submitadd(type='submit' style='display:none;')        
              .form-group.row
                .col-12
                  input#mobileNumber.form-control(type='text', required, data-placement="top" data-toggle="tooltip" title="Please enter valid Indonesian phone number +628 (Minimal Length 13)" placeholder='Mobile number' oninput="this.value=this.value.replace(/(?![+0-9])./gmi,'')", maxlength="15")
              .form-group.row
                .col-12
                  input#firstName.form-control(type='text', required, placeholder='First Name')
              .form-group.row
                .col-12
                  input#lastName.form-control(type='text', required, placeholder='Last Name')
              .form-group.row
                .col-12
                  label Date Of Birth
                  input#dateOfBirth.form-control.daterange(placeholder='Enter Date Of Birth' type="text" autocomplete="off" maxlength="25")
              .form-group.row
                .col-12
                  label(style='padding-right: 10px')
                    input#genderM.cusHeight(type='radio', name='gender' checked)
                    | Male
                  label
                    input#genderF.cusHeight(type='radio', name='gender')
                    | Female
              .form-group.row
                .col-12
                  input#email.form-control(type='email', required, placeholder='Email')
              .form-group.row
                .col-12
                  .error
                    if (messages.errors) 
                      each error in messages.errors
                        label= error
                    if (messages.info)
                      label= messages.info
              .form-group.text-center.row.m-t-20
                .col-12
                  button#btnRegister.btn.btn-danger.btn-block.waves-effect.waves-light(type='button') Register
                  button#DirectToLogin.btn.btn-danger.btn-block.waves-effect.waves-light(type='button') Sign In
                  
          .p-3#flagBtnRedirectToLogin(style='display: none;')
            button#btnRedirectToLogin.btn.btn-danger.btn-block.waves-effect.waves-light(type='button') Redirect to Create Login Account

    .wrapper-page#CreateAccount(style='margin:12% auto; display:none;')
      .card
        .card-body
          .text-center.m-b-15
          .p-3
            .boxRed#errorBoxCreateAccount(style='display:none')
              label#errorCreateAccount(style='margin-bottom: 0px;')
            h3 Create Account
            form#frmCreateAccount.form-horizontal.m-t-20(name='frmCreateAccount')
              input#submitaddAccount(type='submit' style='display:none;')        
              .form-group.row
                .col-12
                  input#createUsername.form-control(type='text', required, placeholder='Username')
              .form-group.row
                .col-12
                  input#createPassword.form-control(type='password', required, placeholder='Password')
              .form-group.row
                .col-12
                  input#createConfirmationPassword.form-control(type='password', required, placeholder='Confirmation Password')
              .form-group.row
                .col-12
                  select#addLevel.form-control.input-lg.select2(required)
                    option(value="A") Admin
                    option(value="U") User
              .form-group.text-center.row.m-t-20
                .col-12
                  button#btnCreateAccount.btn.btn-danger.btn-block.waves-effect.waves-light(type='button') Create Account Login

    .wrapper-page#LoginForm(style='margin:12% auto; display: none;')
          .card
            .card-body
              .text-center.m-b-15
              .p-3
                .boxRed#expired(style='display:none')
                  label#session

                form.form-horizontal.m-t-20(method='POST')
                  .form-group.row
                    .col-12
                      input#username.form-control(type='text', required='', placeholder='Username', value=data.username, name='username')
                  .form-group.row
                    .col-12
                      input#password.form-control(type='password', required='', placeholder='Password', value=data.password, name='password')
                  if (capcha)
                    .form-group.row
                      .col-6
                        img(src="/captcha", alt="")
                      .col-6(style='padding-top:3px')
                        input#capcha.form-control(type='text', required='', name='capcha', style='height:40px;display:inline-block;text-align:center', autocomplete='off', maxlength='4')
                  .form-group.row
                    .col-12
                      .error
                        if (messages.errors) 
                          each error in messages.errors
                            label= error
                        if (messages.info)
                          label= messages.info
                  .form-group.text-center.row.m-t-20
                    .col-12
                      button.btn.btn-danger.btn-block.waves-effect.waves-light(type='submit') Login


    section.footer(style="border-top: #60a2c9;")
      .navbar-fixed-bottom.err-footer
        .col-sm-12
          .box.box-transparant
            #ErrDiv.alert.alert-block.alert-error(style="display:none; background-color:#ffedf0; color: red;")
              a.close(onClick="$('#ErrDiv').hide()") X
              h4.alert-heading Warning!
              span#ErrMsg 
            #SuccessDiv.alert.alert-block.alert-success(style="display:none;")
              a.close(onClick="$('#SuccessDiv').hide()") X
              h4.alert-heading Success!
              span#SuccessMsg

              //- #frmAuth.modal.fade(tabindex='-1', role='dialog', aria-labelledby='EditModalLabel', aria-hidden='true' data-backdrop="static" )
              //-   .modal-dialog.modal-sm(role='dialog')
              //-     .modal-content.animate
              //-       .modal-header
              //-         h5#AddModalLabel.modal-title #{lang.label.auth}
              //-       .modal-body
              //-         if (messages.auth)
              //-           #ErrDivModal.alert.alert-modal.alert-danger
              //-             .form-group
              //-               button.close(type='button', onClick="$('#ErrDivModal').hide()")
              //-                 span(aria-hidden='true') Ã—
              //-               span= messages.auth
              //-         .form-group
              //-           input#auth.form-control(name='auth' type="text" maxlength="6" autocomplete="off")
              //-       .modal-footer
              //-           button#btnSaveEdit.btn.btn-sm.is-green(type='submit') &nbsp;Submit


  //- script(src='./bower_components/jquery/dist/jquery.min.js')
  //- script(src='./bower_components/bootstrap/dist/js/bootstrap.min.js')
  include ../script.pug
  script(src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous")
  script(src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous")
  script(src='/dist/public/js/login.js')
  script.
    $(document).ready(function(){
      $('#testing :input').keypress(function(e){
        if(e.which == 13){
          e.preventDefault();
        }
      });
      
      $('#mobileNumber').tooltip();
      
      $(".daterange").daterangepicker({
        singleDatePicker: true,
        showDropdowns: true,
        minYear: 1901,
        maxYear: parseInt(moment().format('YYYY'),10),
        locale: {
              format: 'DD MMMM YYYY'
          }
      });

      var getMobileNumber;
      $('#btnRegister').on('click', function() {
        var phoneno = /^((\+{1}(628){1})){1}\d{9,12}$/.test($("#mobileNumber").val());
        if(phoneno){
          if (!$('#frmRegiter')[0].checkValidity()) {
            $('#frmRegiter').find('input[type="submit"]').click();
            return false;
          } else {
            var valueGender;
            ($("input[id='genderM']:checked")[0] !== undefined) ? valueGender = "M": valueGender = "F"
            getMobileNumber = $("#mobileNumber").val().replace("+62", "0");
            var param = "mobileNumber=" + getMobileNumber +
                        "&firstName=" + $("#firstName").val() +
                        "&lastName=" + $("#lastName").val() +
                        "&dateOfBirth=" + $("#dateOfBirth").val() +
                        "&gender=" + valueGender +
                        "&email=" + $("#email").val();

            var url = '/registration';
            getAjax(url, param, function (data) {
              if (data.value == "1"){
                //disabled insite #registerParent
                $(this).css("pointer-events","none");
                $("#flagRegisterForm *").attr("disabled", "disabled");
                $("#flagRegisterForm").css("background-color", "#e9ecef");

                //Login Action
                $("#flagBtnRedirectToLogin").show();
                
                $('#ErrDiv').hide()
                $('#ErrDivRegisterForm').hide()
                pageSuccess()
              } else {
                pageError(data.msg)
              }
            });
          }
        } else {
          $('#ErrDivRegisterForm').showError();
          $('#ErrRegisterMsg').html("Your Phone Number is not valid in Indonesia");
        }
      });

      $('#DirectToLogin').on('click', function() {
        $("#RegisterForm").hide();
        $("#LoginForm").show();
      })

      $('#btnRedirectToLogin').on('click', function() {
        $("#RegisterForm").hide();
        $("#CreateAccount").show();
      });
      
      $('#btnCreateAccount').on('click', function() {
        if($("#createPassword").val() == $("#createConfirmationPassword").val())
        {  
          var paramCreateLogin = "&userName=" + $("#createUsername").val() +
                                  "&password=" + $("#createPassword").val() +
                                  "&level=" + $("#addLevel").val() +
                                  "&mobileNumber=" + getMobileNumber;

          var urlCreateLogin = '/create/account/login/user';
          getAjax(urlCreateLogin, paramCreateLogin, function (data) {
            if (data.value == "1"){
              $("#CreateAccount").hide();
              $("#LoginForm").show();
              
              $('#ErrDiv').hide()
              pageSuccess()
            } else {
              pageError(data.msg)
            }
          });
        }
        else {
          $("#errorBoxCreateAccount").show();
          $("#errorCreateAccount").html("Password & Confirmation Password is not matched");
        }
      });

    });